services:
    ds_service.service.service:
        class: Ds\Bundle\ServiceBundle\Service\ServiceService
        arguments:
            - '@doctrine.orm.entity_manager'
            - Ds\Bundle\ServiceBundle\Entity\Service

    ds_service.service.category:
        class: Ds\Bundle\ServiceBundle\Service\CategoryService
        arguments:
            - '@doctrine.orm.entity_manager'
            - Ds\Bundle\ServiceBundle\Entity\Category

    ds_service.service.scenario:
        class: Ds\Bundle\ServiceBundle\Service\ScenarioService
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@ds_bpm.api.factory'
            - '@ds_formio.api'
            - '@ds_config.service.config'
            - Ds\Bundle\ServiceBundle\Entity\Scenario

    ds_service.service.submission:
        class: Ds\Bundle\ServiceBundle\Service\SubmissionService
        arguments:
            - '@doctrine.orm.entity_manager'
            - Ds\Bundle\ServiceBundle\Entity\Submission
            - '@ds_service.service.scenario'
            - '@ds_formio.api'
            - '@ds_config.service.config'

    ds_service.filter.category.search:
        parent: api_platform.doctrine.orm.search_filter
        arguments:
            -
                id: exact
                uuid: exact
                owner: exact
                ownerUuid: exact
                services.uuid: exact
        tags:
            - { name: api_platform.filter, id: ds.category.search }

    ds_service.filter.category.search_translation:
        parent: ds_translation.doctrine.orm.filter.search
        arguments:
            -
                title: partial
                description: partial
                presentation: partial
        tags:
            - { name: api_platform.filter, id: ds.category.search_translation }

    ds_service.filter.category.date:
        parent: api_platform.doctrine.orm.date_filter
        arguments:
            -
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
        tags:
            - { name: api_platform.filter, id: ds.category.date }

    ds_service.filter.category.boolean:
        parent: api_platform.doctrine.orm.boolean_filter
        arguments:
            -
                enabled: ~
        tags:
            - { name: api_platform.filter, id: ds.category.boolean }

    ds_service.filter.category.order:
        parent: api_platform.doctrine.orm.order_filter
        arguments:
            -
                id: ~
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
                owner: ~
                weight: ~
        tags:
            - { name: api_platform.filter, id: ds.category.order }

    ds_service.filter.category.order_translation:
        parent: ds_translation.doctrine.orm.filter.order
        arguments:
            -
                title: ~
        tags:
            - { name: api_platform.filter, id: ds.category.order_translation }

    ds_service.filter.service.search:
        parent: api_platform.doctrine.orm.search_filter
        arguments:
            -
                id: exact
                uuid: exact
                owner: exact
                ownerUuid: exact
                categories.uuid: exact
        tags:
            - { name: api_platform.filter, id: ds.service.search }

    ds_service.filter.service.search_translation:
        parent: ds_translation.doctrine.orm.filter.search
        arguments:
            -
                title: partial
                description: partial
                presentation: partial
        tags:
            - { name: api_platform.filter, id: ds.service.search_translation }

    ds_service.filter.service.date:
        parent: api_platform.doctrine.orm.date_filter
        arguments:
            -
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
        tags:
            - { name: api_platform.filter, id: ds.service.date }

    ds_service.filter.service.boolean:
        parent: api_platform.doctrine.orm.boolean_filter
        arguments:
            -
                enabled: ~
        tags:
            - { name: api_platform.filter, id: ds.service.boolean }

    ds_service.filter.service.order:
        parent: api_platform.doctrine.orm.order_filter
        arguments:
            -
                id: ~
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
                owner: ~
                weight: ~
        tags:
            - { name: api_platform.filter, id: ds.service.order }

    ds_service.filter.service.order_translation:
        parent: ds_translation.doctrine.orm.filter.order
        arguments:
            -
                title: ~
        tags:
            - { name: api_platform.filter, id: ds.service.order_translation }

    ds_service.filter.scenario.search:
        parent: api_platform.doctrine.orm.search_filter
        arguments:
            -
                id: exact
                uuid: exact
                owner: exact
                ownerUuid: exact
                type: exact
                service.uuid: exact
        tags:
            - { name: api_platform.filter, id: ds.scenario.search }

    ds_service.filter.scenario.search_translation:
        parent: ds_translation.doctrine.orm.filter.search
        arguments:
            -
                title: partial
                description: partial
                presentation: partial
        tags:
            - { name: api_platform.filter, id: ds.scenario.search_translation }

    ds_service.filter.scenario.date:
        parent: api_platform.doctrine.orm.date_filter
        arguments:
            -
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
        tags:
            - { name: api_platform.filter, id: ds.scenario.date }

    ds_service.filter.scenario.boolean:
        parent: api_platform.doctrine.orm.boolean_filter
        arguments:
            -
                enabled: ~
        tags:
            - { name: api_platform.filter, id: ds.scenario.boolean }

    ds_service.filter.scenario.order:
        parent: api_platform.doctrine.orm.order_filter
        arguments:
            -
                id: ~
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
                owner: ~
                type: ~
                weight: ~
        tags:
            - { name: api_platform.filter, id: ds.scenario.order }

    ds_service.filter.scenario.order_translation:
        parent: ds_translation.doctrine.orm.filter.order
        arguments:
            -
                title: ~
        tags:
            - { name: api_platform.filter, id: ds.scenario.order_translation }

    ds_service.filter.submission.search:
        parent: api_platform.doctrine.orm.search_filter
        arguments:
            -
                id: exact
                uuid: exact
                owner: exact
                ownerUuid: exact
                identity: exact
                identityUuid: exact
                state: exact
                scenario.uuid: exact
        tags:
            - { name: api_platform.filter, id: ds.submission.search }

    ds_service.filter.submission.date:
        parent: api_platform.doctrine.orm.date_filter
        arguments:
            -
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
        tags:
            - { name: api_platform.filter, id: ds.submission.date }

    ds_service.filter.submission.boolean:
        parent: api_platform.doctrine.orm.boolean_filter
        arguments:
            -
                enabled: ~
        tags:
            - { name: api_platform.filter, id: ds.submission.boolean }

    ds_service.filter.submission.order:
        parent: api_platform.doctrine.orm.order_filter
        arguments:
            -
                id: ~
                createdAt: ~
                updatedAt: ~
                deletedAt: ~
                owner: ~
                identity: ~
                state: ~
                weight: ~
        tags:
            - { name: api_platform.filter, id: ds.submission.order }

    ds_service.form.flow.formio:
        parent: craue.form.flow
        class: Ds\Bundle\ServiceBundle\Form\Flow\FormioFlow

    ds_service.form.flow.formio.factory:
        class: Ds\Bundle\ServiceBundle\Form\Flow\Formio\Factory
        arguments:
            - '@ds_service.form.flow.formio'

    ds_service.event_listener.submission.validation:
        class: Ds\Bundle\ServiceBundle\EventListener\Submission\Validation\DataListener
        arguments:
            - '@ds_service.service.submission'
        tags:
            - { name: kernel.event_listener, event: kernel.view, method: kernelView, priority: 64 }

    ds_service.event_listener.submission.owner:
        class: Ds\Bundle\ServiceBundle\EventListener\Submission\OwnerListener
        tags:
            - { name: doctrine.orm.entity_listener, entity: Ds\Bundle\ServiceBundle\Entity\Submission, event: prePersist }

    ds_service.event_listener.submission.delegation.bpm:
        class: Ds\Bundle\ServiceBundle\EventListener\Submission\Delegation\BpmListener
        arguments:
            - '@service_container'
        tags:
            - { name: doctrine.orm.entity_listener, entity: Ds\Bundle\ServiceBundle\Entity\Submission, event: postPersist }

    Ds\Bundle\ServiceBundle\Action\Scenario\FormAction:
        class: Ds\Bundle\ServiceBundle\Action\Scenario\FormAction
        arguments:
            - '@ds_service.service.scenario'

    Ds\Bundle\ServiceBundle\Action\Scenario\Form\TranslationAction:
        class: Ds\Bundle\ServiceBundle\Action\Scenario\Form\TranslationAction
        arguments:
            - '@ds_service.service.scenario'
            - '@request_stack'
            - "%locale%"

    Ds\Bundle\ServiceBundle\Action\Scenario\SubmissionsAction:
        class: Ds\Bundle\ServiceBundle\Action\Scenario\SubmissionsAction
        arguments:
            - '@request_stack'
            - '@ds_service.service.scenario'
            - '@ds_service.service.submission'
